let u=[],d=0;const y=4,T=e=>{let n=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(r){return t.lc=n.push(r),()=>{for(let l=d+y;l<u.length;)u[l]===r?u.splice(l,y):l+=y;let s=n.indexOf(r);~s&&(n.splice(s,1),--t.lc||t.off())}},notify(r,s){let l=!u.length;for(let f of n)u.push(f,t.value,r,s);if(l){for(d=0;d<u.length;d+=y)u[d](u[d+1],u[d+2],u[d+3]);u.length=0}},off(){},set(r){let s=t.value;s!==r&&(t.value=r,t.notify(s))},subscribe(r){let s=t.listen(r);return r(t.value),s},value:e};return t},N=5,h=6,L=10;let O=(e,n,t,r)=>(e.events=e.events||{},e.events[t+L]||(e.events[t+L]=r(s=>{e.events[t].reduceRight((l,f)=>(f(l),l),{shared:{},...s})})),e.events[t]=e.events[t]||[],e.events[t].push(n),()=>{let s=e.events[t],l=s.indexOf(n);s.splice(l,1),s.length||(delete e.events[t],e.events[t+L](),delete e.events[t+L])}),I=1e3,M=(e,n)=>O(e,r=>{let s=n(r);s&&e.events[h].push(s)},N,r=>{let s=e.listen;e.listen=(...f)=>(!e.lc&&!e.active&&(e.active=!0,r()),s(...f));let l=e.off;return e.events[h]=[],e.off=()=>{l(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let f of e.events[h])f();e.events[h]=[]}},I)},()=>{e.listen=s,e.off=l}});const S=(e={})=>{let n=T(e);return n.setKey=function(t,r){let s=n.value;typeof r>"u"&&t in n.value?(n.value={...n.value},delete n.value[t],n.notify(s,t)):n.value[t]!==r&&(n.value={...n.value,[t]:r},n.notify(s,t))},n};let w=e=>e,E={},o={addEventListener(){},removeEventListener(){}};function U(){try{return typeof localStorage<"u"}catch{return!1}}U()&&(E=localStorage);let R={addEventListener(e,n,t){window.addEventListener("storage",n),window.addEventListener("pageshow",t)},removeEventListener(e,n,t){window.removeEventListener("storage",n),window.removeEventListener("pageshow",t)}};typeof window<"u"&&(o=R);function _(e,n={},t={}){let r=t.encode||w,s=t.decode||w,l=S(),f=l.setKey,m=(i,a)=>{typeof a>"u"?(t.listen!==!1&&o.perKey&&o.removeEventListener(e+i,g,c),delete E[e+i]):(t.listen!==!1&&o.perKey&&!(i in l.value)&&o.addEventListener(e+i,g,c),E[e+i]=r(a))};l.setKey=(i,a)=>{m(i,a),f(i,a)};let p=l.set;l.set=function(i){for(let a in i)m(a,i[a]);for(let a in l.value)a in i||m(a,void 0);p(i)};function g(i){i.key?i.key.startsWith(e)&&(i.newValue===null?f(i.key.slice(e.length),void 0):f(i.key.slice(e.length),s(i.newValue))):p({})}function c(){let i={...n};for(let a in E)a.startsWith(e)&&(i[a.slice(e.length)]=s(E[a]));for(let a in i)l.setKey(a,i[a])}return M(l,()=>{if(c(),t.listen!==!1)return o.addEventListener(e,g,c),()=>{o.removeEventListener(e,g,c);for(let i in l.value)o.removeEventListener(e+i,g,c)}}),l}const C=T(!1),v=_("cart:",{},{encode:JSON.stringify,decode:JSON.parse}),K=e=>{const n=v.get()[e.id];n?v.setKey(e.id,{...n,quantity:n.quantity+e.quantity}):v.setKey(e.id,e),C.set(!0)},Q=(e,n)=>{const t=v.get()[e];t&&(n<=0?k(e):v.setKey(e,{...t,quantity:n}))},k=e=>{v.setKey(e,void 0)},q=()=>{Object.keys(v.get()).forEach(n=>v.setKey(n,void 0))};export{K as a,q as b,v as c,C as i,k as r,Q as u};
