---
import '@/styles/globals.css';
import '@/styles/pages/home.css';
import '@/styles/pages/page.css';

import Partners from '@/components/partners.astro';
import PageLayout from '@/layouts/page-layout.astro';

import homeBannerImg from '@/assets/images/home/home-banner-min.jpg';
import ProductItemCard from '@/components/products/product-item-card.astro';
import { Image } from 'astro:assets';
import { ArrowRight } from 'lucide-react';

import { useTranslations } from '@/i18n/ui';
import { getProductTranslation } from '@/i18n/utils';
import { supabase } from "@/lib/supabase";

const lang = 'zh';
const t = useTranslations(lang);

// Fetch featured products from Supabase
const { data: products } = await supabase
  .from('products')
  .select('*')
  .eq('featured', true)
  .limit(4);

// Transform products for display using translation helper
const featuredProducts = (products || []).map(p => {
  const translated = getProductTranslation(p, lang);
  return {
    ...p,
    ...translated
  };
});

// Fetch Hero Config (Note: Site config might usually need i18n too, but assuming English for now or strictly purely visual)
let heroConfig = {
	title_h1: 'Trusted by Global Industry Leaders',
	title_h2: 'High Quality Cleanroom Stainless Steel Furnitures'
};
try {
  const { data } = await supabase.from('site_config').select('value').eq('key', 'home_hero').single();
  if (data) heroConfig = { ...heroConfig, ...data.value };
} catch (e) {}

// Static translations for SEO
const pageTitle = "洁净室不锈钢家具与设备 | ALDR EME";
const seoDescription = "ALDR EME 专业生产高品质洁净室不锈钢家具和设备。全球信赖的耐用、可靠的实验室解决方案。";

// Keywords should also be localized
const seoKeywords = "洁净室家具, 不锈钢实验室设备, 更衣凳, 传递窗, 工业工作台, 制药设备, ALDR EME";

const seoJsonLd = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "ALDR EME",
  "url": "https://www.aldreme.com/zh",
  "logo": "https://www.aldreme.com/logo-light.png",
  "sameAs": [],
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": "+86 18051120028", // Use CN number
    "contactType": "sales",
    "areaServed": "CN"
  }
};
---

<PageLayout 
  pageTitle={pageTitle} 
  seoDescription={seoDescription}
  seoJsonLd={seoJsonLd}
  seoKeywords={seoKeywords}
>
	<div class='flex flex-col px-0 sm:px-[15vw]'>
		<Image src={homeBannerImg} alt="首页横幅" class="page-banner-img" />

		<div class="home-banner-caption">
             {/* Localized Banner Text - Hardcoded for now based on English pattern or just use t() if we add keys */}
			<h1 class="home-banner-caption-h0">全球行业领导者信赖之选</h1>
			
			<h2 class="home-banner-caption-h1">
				<span class='font-bold'>A</span>{'dvanced'}&nbsp;
				<span class='font-bold'>L</span>{'aboratory'}&nbsp;
				<span class='font-bold'>D</span>{'urable'}&nbsp;
				<span class='font-bold'>R</span>{'eliable'}
			</h2>

			<h3 class="home-banner-caption-h2">
				高品质洁净室不锈钢家具
			</h3>
		</div>

		{/* Featured Products Section */}
		<section class="relative z-10 mt-12 sm:mt-24 px-6 sm:px-0 flex flex-col">
			<div class="flex flex-col sm:flex-row sm:items-center justify-between w-full mb-8 lg:mb-12 gap-4">
				<h2 class="text-2xl sm:text-3xl font-bold text-white border-l-4 border-blue-600 pl-4 tracking-tight">
					{t('featured-products') || '精选产品'}
				</h2>
				<a href="/zh/products" class="flex items-center text-blue-400 hover:text-blue-300 transition-colors group text-sm font-medium self-start sm:self-auto">
					{t('view-all-products') || '查看所有产品'}
					<ArrowRight className="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform" />
				</a>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 w-full">
				{featuredProducts.map((product, index) => (
					<ProductItemCard index={index} productData={product as any} />
				))}
			</div>
		</section>

		<div class='mt-[5vw] flex flex-col justify-center items-center text-white animate-fadein-up duration-500 delay-300 z-10'>
			<h1 class="text-[4.5vw] font-bold my-[3vmin]">{t('our-partners') || '合作伙伴'}</h1>

			<Partners />
		</div>
	</div>
</PageLayout>
