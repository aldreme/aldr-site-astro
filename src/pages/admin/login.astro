---
import "@/styles/globals.css";
---

<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Admin Login - ALDR</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
</head>
<body class="bg-gray-50 dark:bg-zinc-950 flex items-center justify-center min-h-screen p-6">
    <div class="w-full max-w-md animate-in fade-in slide-in-from-bottom-8 duration-1000">
        <div class="mb-10 text-center space-y-4">
            <div class="inline-flex w-16 h-16 rounded-2xl bg-blue-600 items-center justify-center shadow-2xl shadow-blue-500/40">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>
            </div>
            <div class="space-y-1">
                <h1 class="text-3xl font-extrabold tracking-tight text-gray-900 dark:text-white">Admin Console</h1>
                <p class="text-gray-500 dark:text-gray-400">Advanced Laboratory Durable Reliable</p>
            </div>
        </div>

        <div class="p-8 space-y-8 bg-white dark:bg-zinc-900 rounded-3xl shadow-xl shadow-gray-200/50 dark:shadow-none border border-gray-100 dark:border-zinc-800">
            <div class="space-y-2">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white">Welcome back</h2>
                <p class="text-sm text-gray-500">Please sign in to your administrator account</p>
            </div>
            
            <form id="login-form" class="space-y-6">
                <div class="space-y-2">
                    <label for="email" class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">Email Address</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        placeholder="admin@aldr.com"
                        required 
                        class="w-full px-4 py-3 border border-gray-200 dark:border-zinc-800 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 dark:bg-zinc-800/50 text-gray-900 dark:text-white transition-all"
                    />
                </div>
                <div class="space-y-2">
                    <label for="password" class="text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1">Password</label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        placeholder="••••••••"
                        required 
                        class="w-full px-4 py-3 border border-gray-200 dark:border-zinc-800 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 dark:bg-zinc-800/50 text-gray-900 dark:text-white transition-all"
                    />
                </div>
                <div id="error-message" class="p-3 text-red-500 text-xs bg-red-50 dark:bg-red-900/10 rounded-xl border border-red-100 dark:border-red-900/20 hidden"></div>
                <button 
                    type="submit" 
                    id="submit-btn"
                    class="w-full px-4 py-4 text-white font-bold bg-blue-600 rounded-2xl hover:bg-blue-700 shadow-lg shadow-blue-500/30 transition-all active:scale-[0.98] flex items-center justify-center gap-2"
                >
                    <span>Sign In to Dashboard</span>
                </button>
            </form>
        </div>
        
        <p class="mt-8 text-center text-xs text-gray-400">
            &copy; {new Date().getFullYear()} ALDR. All rights reserved.
        </p>
    </div>

    <script>
        import { supabase } from "@/lib/supabase";

        const form = document.getElementById("login-form") as HTMLFormElement;
        const errorMessage = document.getElementById("error-message");

        form?.addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const email = formData.get("email") as string;
            const password = formData.get("password") as string;

            errorMessage!.classList.add("hidden");
            errorMessage!.textContent = "";

            const { data, error } = await supabase.auth.signInWithPassword({
                email,
                password
            });

            if (error) {
                errorMessage!.textContent = error.message;
                errorMessage!.classList.remove("hidden");
            } else if (data.session) {
                // Set cookies for middleware
                document.cookie = `sb-access-token=${data.session.access_token}; Path=/; Max-Age=${data.session.expires_in}; SameSite=Lax; Secure`;
                document.cookie = `sb-refresh-token=${data.session.refresh_token}; Path=/; Max-Age=${3600 * 24 * 30}; SameSite=Lax; Secure`;
                
                window.location.href = "/admin";
            }
        });
    </script>
</body>
</html>
