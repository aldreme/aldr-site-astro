---
import { supabase } from "@/lib/supabase";
import "@/styles/components/partners.css";

// Fetch partners from Supabase
const { data: partners } = await supabase
  .from('partners')
  .select('*')
  .order('created_at', { ascending: true });

// Fallback if db is empty or error, though we migrated data.
// We display partners twice for the marquee effect.
const displayPartners = partners ? [...partners, ...partners] : [];
---

<div class='partners-container'>
  <div class='partners-track'>
    {
      displayPartners.map((item) => (
        <div class='partners-item-wrapper'>
          <a href={item.website.startsWith("http") ? item.website : `https://${item.website}`} target="_blank" rel="noopener noreferrer">
             {/* Use standard img tag for remote URL or Astro Image with remote optimization if configured */}
             {/* Since we have full URL in logo_url if it's external, or path if internal. */}
             {/* Migrated data has filenames. We need to construct URL. */}
             <img 
                alt={item.name} 
                src={item.logo_url?.startsWith('http') 
                    ? item.logo_url 
                    : `${import.meta.env.PUBLIC_SUPABASE_URL}/storage/v1/object/public/partners/${item.logo_url}`}
                class='w-full h-full object-contain'
                loading="lazy"
            />
          </a>
        </div>
      ))
    }
  </div>
</div>